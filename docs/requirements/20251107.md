# 方向

1. [x] 接入 Minecraft 服务器情况查询和玩家 Minecraft 档案信息。【11/7】
   使用 /backend/src/lib/minecraft 下的方法，创建一个 API，分别调用这些类。实现四个功能。最重要的是 Ping 功能。添加好四个控制器以后，在后台的“信息状态” Tag 下创建一个页面（LuckPerms 下方），名为：服务器状态。里面需要我允许配置专属于我们网站的 Minecraft 服务器数据。包括服务器显示名字（外显）、服务器中文内部代号、服务器英文内部代号、服务器 IP 地址。填写好信息特别是 IP 地址以后，自动调用 lib 方法，ping 服务器，并显示 MOTD 在后台页面内。

   服务器信息因为比较复杂，单独创建一个表存储，以方便后续扩展和开发。

   随后，完善 Minecraft 档案信息。我注意到数据表内的 minecraftProfiles 带有 minecraftid，这个不需要记录 id，因为已经有 authme 绑定了，记录一下 authme 绑定表的 id 信息就行了。playerUuid 也是，authme 绑定表存一下 authme 被绑定账户的 uuid，也拿过来存一下。昵称要允许有多个，authme 绑定信息也是有可能有多个。一定要允许，但是也需要设置一个主的 nick 和 id。此外，前端 /profile/info 内的玩家绑定信息的用户绑定需要能设置主 AuthMe 账户。

   后续补充：

   可在 AuthmeBindingService 里接入 Redis（或其他 KV）缓存 LuckPermsService.getPlayerByUuid 结果，设置 TTL，减少跨库查询。
   对 authme_bindings 周期性调度批量同步 UUID（利用队列/cron），避免登录/请求链路上频繁触发 cross-DB。
   Minecraft 服务器 ping 结果可落地缓存（含失效时间），后台页面优先读取缓存并提供手动刷新，降低即时 ping 压力。

2. [ ] 接入 MCSM 服务器数据。【11/7】

3. [ ] 接入微软账号授权。【11/8】

4. [ ] 接入短信验证码、邮箱验证。【11/8】

5. [ ] 公司系统实现。【11/9】

6. [ ] 铁路数据库系统。接入 MTR。【11/10】

7. [ ] 登录系统允许 SSO，此外同时启动图床项目开发。【11/12】

8. [ ] 完善客户端更新数据，此外同时启动客户端 Agent 和 Patcher 的开发。【11/13】

9. [ ] 准备 1.20.1 升级，配置插件等功能。【12/1 前】

# 11/7 需要调整的细节

- [ ] 支持重置密码、忘记密码后的重置密码。**【暂缓，源于：先决条件是短信验证码、邮箱验证做好】**
- [ ] 实现注销账户系统。通过验证当前账户密码、邮箱验证码验证身份，通过验证后显示当前账户所有信息。输入文字确定后，进入两天冷静期。
      不过注销账户不是真的注销，只是把用户类型变成注销用户。如果这个用户注册用户回来（用已有的邮箱，authme 账户别管），自动恢复身份。只不过需要记录一下注销时间等信息，然后放在后台玩家列表里面让人看见。
- [ ] PIIC 生成方式、重新生成功能以及对应的前端。**_（玩家档案页面的前提）_**
- [ ] AuthMe 内的每个玩家的绑定记录也需要跟随记录，不是只当作绑定数据绑定完就没了，要能看到玩家的流转记录。添加一下这个功能。
      添加好功能以后，把后台页面中的用户与玩家拆分开来。用户列表看用户的；玩家列表看 AuthMe 数据库内所有用户信息，也是用列表列出来。【AuthMe 数据库存在不稳定性，可能连不上，这个需要注意】以及对应的绑定用户，并且还要能看到用户的绑定流转信息。
      用户页面进一步完善操作功能，不允许出现“等待功能完善”的字样。如果缺乏功能，你就立刻总结，总结好以后把需要增加的内容发送给我，我来批准实施。作为管理员（Administrator）的功能要玩整，删除用户、修改绑定信息、重置密码都是有必要的。
      RBAC 管理页面也要进一步完善操作功能，缺什么你直接补上去，不允许出现“等待功能完善”的字样。如果缺乏功能，你就立刻总结，总结好以后把需要增加的内容发送给我，我来批准实施。权限组可以互相叠加而不是只能有一个，这点请注意。此外权限组还需要有 Label 方便给玩家添加，当然也要允许添加没有任何权限的 Label。有的时候，新增的模块，管理员自己都没权限，需要一个地方列出所有的权限，并且能够直接让管理员给自己添加权限节点~ 这种需求一定要实现，此外还要发动脑筋开放思想，多想一点场景。
- [x] 会话把 UA 解析成 mobile、platform 显示在前端 /profile/info 内，不要直接显示 UA，丑死了。IP 前面用图标 UIcon 来区分平板手机 PC。
- [x] /profile/info 内的 aside 菜单有三个 menu 对应着条件渲染的三个卡片。现在我要求你把这三个卡片拆分掉，分成三个路由，方便后期扩展，否则 profileinfoview 会越写越大。为了防止你乱改 UI，我要求你这样子改：把 profileviewinfo 复制三份，然后各改各的，比如现在是基础信息的卡片，那就把其他俩个相关的东西删掉。以此类推，随后添加上对应的路由，实现好的效果。此外，后端的 me 接口拆成三个。

# 性能优化

- [ ] AuthMe 数据库、LuckPerms 数据库都是外部的数据库联表查询，可能存在连接超时的异常情况。所以，用户的 AuthMe 相关信息可以使用 Redis 存储，减少性能延时。ENV 内添加一个 Redis 调用变量，并创建一个 ENV.SAMPLE（ENV SAMPLE 其他信息参照现在的 env 复制一份）。在未填写 Redis 信息的时候默认不启用缓存，不要影响项目启动。
- [x] 目前已有的，调用**类 Key-Value 数据表 config 表**的模块大概有四五个了。但是目前只有“LuckPerms 权限组显示名称”会在没有 config 表内对应的 key 时自动创建命名空间和 key。我要求你给其他的 LuckPerms、AuthMe 等模块加一个在没有模块的时候自动创建命名空间的功能。并且创建完以后，在不影响现有项目结构的基础下进行小范围测试，确保你写的真的有用，比如写个单元测试，写完以后删掉单元测试。**【11/7 完成】**
